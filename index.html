<script>
  const cloudName = "dcwn89zng"; 
  const preset = "rm_unsigned_video"; 

  async function fetchVideos() {
    const response = await fetch(`https://res.cloudinary.com/${cloudName}/video/list/portfolio-vids.json?t=${Date.now()}`);
    const data = await response.json();
    const gallery = document.getElementById("gallery");
    gallery.innerHTML = "";
    data.resources.forEach(file => {
      const card = document.createElement("div");
      card.className = "card";

      // Video or GIF preview
      const video = document.createElement("video");
      video.src = `https://res.cloudinary.com/${cloudName}/video/upload/${file.public_id}.${file.format}`;
      video.controls = true;
      card.appendChild(video);

      // Filename
      const name = document.createElement("div");
      name.textContent = file.public_id.split("/").pop();
      card.appendChild(name);

      // Delete button
      const delBtn = document.createElement("button");
      delBtn.textContent = "Delete";
      delBtn.onclick = async () => {
        if (confirm("Delete this file?")) {
          const res = await fetch(`https://api.cloudinary.com/v1_1/${cloudName}/delete_by_token`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ token: file.delete_token })
          });
          if (res.ok) {
            alert("Deleted!");
            fetchVideos(); // refresh list
          } else {
            alert("Error deleting file");
          }
        }
      };
      card.appendChild(delBtn);

      gallery.appendChild(card);
    });
  }

  window.onload = fetchVideos;
</script>
